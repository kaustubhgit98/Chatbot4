<!DOCTYPE html>
<html lang="en" x-data="app()" x-init="init()" :class="{ 'dark': isDark }">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beesto AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: { sans: ['Sora', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
      colors: {
        honey: { 300:'#fcd34d', 400:'#fbbf24', 500:'#f59e0b', 600:'#d97706', 700:'#b45309' },
        ink:   { 50:'#f8f8f8', 100:'#f0f0f0', 200:'#e2e2e2', 300:'#c8c8c8', 400:'#a0a0a0',
                 500:'#717171', 600:'#4a4a4a', 700:'#2d2d2d', 800:'#1e1e1e', 850:'#181818',
                 900:'#111111', 950:'#0a0a0a' }
      },
      animation: {
        'fade-up':   'fadeUp 0.35s ease-out both',
        'pulse-dot': 'pulseDot 1.4s ease-in-out infinite',
        'shimmer':   'shimmer 1.5s linear infinite',
      },
      keyframes: {
        fadeUp:    { '0%': { opacity:'0', transform:'translateY(12px)' }, '100%': { opacity:'1', transform:'translateY(0)' } },
        pulseDot:  { '0%,100%': { opacity:'0.3', transform:'scale(0.8)' }, '50%': { opacity:'1', transform:'scale(1)' } },
        shimmer:   { '0%': { backgroundPosition:'200% 0' }, '100%': { backgroundPosition:'-200% 0' } },
      }
    }
  }
}
</script>
<link rel="stylesheet" href="css/styles.css">
</head>

<body class="font-sans antialiased h-screen overflow-hidden dark:bg-ink-950 bg-ink-50 transition-colors duration-300">
<div class="flex h-full">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR -->
<aside id="sidebar"
  :class="sidebarOpen ? 'w-[260px]' : 'w-0 -translate-x-full md:w-0 md:translate-x-0'"
  class="fixed md:relative z-40 h-full flex flex-col transition-all duration-300 ease-in-out overflow-hidden
         dark:bg-ink-900 bg-white border-r dark:border-ink-800 border-ink-200 shrink-0">
  <div class="flex flex-col h-full min-w-[260px]">

    <!-- Logo -->
    <div class="flex items-center gap-3 px-5 py-5 border-b dark:border-ink-800 border-ink-200">
      <div class="w-8 h-8 rounded-xl bg-honey-500 flex items-center justify-center text-lg shadow-lg shadow-honey-500/30">üêù</div>
      <span class="font-semibold text-base dark:text-white text-ink-900 tracking-tight">Beesto AI</span>
      <button @click="sidebarOpen=false" class="ml-auto md:hidden p-1.5 rounded-lg dark:hover:bg-ink-800 hover:bg-ink-100 dark:text-ink-400 text-ink-500">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <!-- New Chat -->
    <div class="px-3 pt-3 pb-2">
      <button @click="newChat()"
        class="w-full flex items-center gap-2.5 px-3 py-2.5 rounded-xl text-sm font-medium transition-all duration-200
               dark:bg-ink-800 bg-ink-100 dark:hover:bg-ink-700 hover:bg-ink-200
               dark:text-ink-200 text-ink-700 group">
        <svg class="w-4 h-4 dark:text-ink-400 text-ink-500 group-hover:text-honey-500 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M12 4v16m8-8H4"/></svg>
        New conversation
      </button>
    </div>

    <!-- Search -->
    <div class="px-3 pb-2">
      <div class="relative">
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 dark:text-ink-500 text-ink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" x-model="searchQuery" placeholder="Search conversations..."
          class="w-full pl-8 pr-3 py-2 text-xs rounded-lg dark:bg-ink-800 bg-ink-100 dark:text-ink-300 text-ink-700
                 placeholder-ink-400 border-0 outline-none focus:ring-1 focus:ring-honey-500/50 transition-all">
      </div>
    </div>

    <!-- Chat list -->
    <div class="flex-1 overflow-y-auto px-2 pb-2 space-y-0.5 sidebar-scroll">
      <template x-if="filteredChats.length === 0">
        <div class="px-3 py-6 text-center text-xs dark:text-ink-600 text-ink-400">No conversations yet</div>
      </template>
      <template x-for="chat in filteredChats" :key="chat.id">
        <div @click="loadChat(chat.id)"
          :class="currentChatId===chat.id
            ? 'dark:bg-ink-800 bg-ink-100 dark:text-white text-ink-900'
            : 'dark:text-ink-400 text-ink-600 dark:hover:bg-ink-800/60 hover:bg-ink-100/80 hover:text-ink-900 dark:hover:text-ink-200'"
          class="group flex items-center gap-2.5 px-3 py-2.5 rounded-xl cursor-pointer transition-all duration-150 relative">
          <svg class="w-3.5 h-3.5 shrink-0 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
          </svg>
          <span x-text="chat.title" class="text-xs truncate flex-1"></span>
          <button @click.stop="deleteChat(chat.id)"
            class="opacity-0 group-hover:opacity-100 p-1 rounded-md dark:hover:bg-red-500/20 hover:bg-red-100
                   dark:text-ink-500 text-ink-400 hover:text-red-500 transition-all shrink-0">
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
          </button>
        </div>
      </template>
    </div>

    <!-- Bottom settings -->
    <div class="p-3 border-t dark:border-ink-800 border-ink-200 space-y-1">
      <button @click="showSettings=true"
        class="w-full flex items-center gap-2.5 px-3 py-2.5 rounded-xl text-xs font-medium
               dark:text-ink-400 text-ink-600 dark:hover:bg-ink-800 hover:bg-ink-100 transition-all">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
        Settings
      </button>
      <button @click="toggleTheme()"
        class="w-full flex items-center gap-2.5 px-3 py-2.5 rounded-xl text-xs font-medium
               dark:text-ink-400 text-ink-600 dark:hover:bg-ink-800 hover:bg-ink-100 transition-all">
        <svg x-show="isDark" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        <svg x-show="!isDark" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        <span x-text="isDark ? 'Light mode' : 'Dark mode'"></span>
      </button>
    </div>
  </div>
</aside>

<!-- Mobile overlay -->
<div x-show="sidebarOpen" @click="sidebarOpen=false"
  class="fixed inset-0 bg-black/40 backdrop-blur-sm z-30 md:hidden" x-transition.opacity></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN -->
<main class="flex-1 flex flex-col h-full min-w-0 relative">

  <!-- Top bar -->
  <header class="flex items-center gap-3 px-4 py-3 border-b dark:border-ink-800 border-ink-200
                 dark:bg-ink-950/80 bg-white/80 backdrop-blur-xl z-20 shrink-0">
    <button @click="sidebarOpen=!sidebarOpen"
      class="p-2 rounded-xl dark:hover:bg-ink-800 hover:bg-ink-100 dark:text-ink-400 text-ink-500 transition-all">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
    </button>

    <div class="flex-1 min-w-0">
      <h1 class="text-sm font-semibold truncate dark:text-white text-ink-900"
        x-text="currentChat?.title || 'Beesto AI'"></h1>
    </div>

    <!-- Model picker -->
    <div class="relative" x-data="{open:false}">
      <button @click="open=!open"
        class="flex items-center gap-2 pl-3 pr-2.5 py-1.5 rounded-xl text-xs font-medium transition-all
               dark:bg-ink-800 bg-ink-100 dark:text-ink-300 text-ink-700 dark:hover:bg-ink-700 hover:bg-ink-200 border dark:border-ink-700 border-ink-200">
        <span class="w-1.5 h-1.5 rounded-full bg-green-400 shrink-0"></span>
        <span x-text="selectedModel.name" class="max-w-[140px] truncate"></span>
        <svg class="w-3 h-3 opacity-50 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M19 9l-7 7-7-7"/></svg>
      </button>
      <div x-show="open" @click.away="open=false" x-transition:enter="transition ease-out duration-150"
        x-transition:enter-start="opacity-0 scale-95 -translate-y-2" x-transition:enter-end="opacity-100 scale-100 translate-y-0"
        class="absolute right-0 top-full mt-2 w-72 rounded-2xl dark:bg-ink-800 bg-white
               border dark:border-ink-700 border-ink-200 shadow-2xl dark:shadow-black/50 z-50 overflow-hidden">
        <div class="p-1.5 max-h-[420px] overflow-y-auto sidebar-scroll">
          <template x-for="provider in modelProviders" :key="provider.name">
            <div class="mb-1">
              <div class="px-3 py-2 text-[10px] font-semibold uppercase tracking-widest dark:text-ink-500 text-ink-400" x-text="provider.name"></div>
              <template x-for="model in provider.models" :key="model.id">
                <button @click="selectedModel=model;saveSettings();open=false"
                  :class="selectedModel.id===model.id ? 'dark:bg-honey-500/15 bg-honey-50 dark:text-honey-400 text-honey-700' : 'dark:text-ink-300 text-ink-700 dark:hover:bg-ink-700/50 hover:bg-ink-50'"
                  class="w-full text-left px-3 py-2 rounded-xl text-xs transition-all flex items-center justify-between gap-2">
                  <span x-text="model.name" class="font-medium"></span>
                  <div class="flex items-center gap-1.5 shrink-0">
                    <span x-show="model.vision" class="text-[9px] px-1.5 py-0.5 rounded-full dark:bg-purple-500/20 bg-purple-100 dark:text-purple-400 text-purple-600 font-medium">Vision</span>
                    <span x-show="model.fast" class="text-[9px] px-1.5 py-0.5 rounded-full dark:bg-green-500/20 bg-green-100 dark:text-green-400 text-green-600 font-medium">Fast</span>
                  </div>
                </button>
              </template>
            </div>
          </template>
        </div>
      </div>
    </div>
  </header>

  <!-- Messages area -->
  <div id="chat-messages" class="flex-1 overflow-y-auto chat-scroll relative"
    @dragover.prevent="dragOver=true" @dragleave.self="dragOver=false" @drop.prevent="handleDrop($event)">

    <!-- Drag overlay -->
    <div x-show="dragOver" x-transition.opacity
      class="fixed inset-0 z-50 flex items-center justify-center"
      style="background:rgba(0,0,0,0.6);backdrop-filter:blur(4px)">
      <div class="rounded-3xl border-2 border-dashed border-honey-500 p-16 text-center bg-ink-900/80">
        <div class="text-5xl mb-3">üìé</div>
        <p class="text-white font-semibold text-lg">Drop your files here</p>
        <p class="text-ink-400 text-sm mt-1">Images, code, PDFs, text files</p>
      </div>
    </div>

    <!-- Welcome screen -->
    <div x-show="!currentChat || currentChat.messages.length === 0"
      class="h-full flex flex-col items-center justify-center p-6 animate-fade-up">
      <div class="w-16 h-16 rounded-3xl bg-honey-500/10 border border-honey-500/30 flex items-center justify-center text-4xl mb-6 shadow-xl shadow-honey-500/10">üêù</div>
      <h2 class="text-2xl font-semibold dark:text-white text-ink-900 mb-2 tracking-tight">How can I help you today?</h2>
      <p class="dark:text-ink-500 text-ink-400 text-sm mb-10">Powered by the world's best AI models</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 w-full max-w-2xl">
        <template x-for="suggestion in suggestions" :key="suggestion.text">
          <button @click="sendMessage(suggestion.text)"
            class="flex items-start gap-3 p-4 rounded-2xl text-left transition-all duration-200 group
                   dark:bg-ink-900 bg-white dark:hover:bg-ink-800 hover:bg-ink-50
                   border dark:border-ink-800 border-ink-200 dark:hover:border-ink-700 hover:border-ink-300
                   dark:shadow-none shadow-sm hover:shadow-md">
            <span class="text-xl shrink-0" x-text="suggestion.icon"></span>
            <div>
              <p class="text-sm font-medium dark:text-ink-200 text-ink-800 group-hover:text-honey-600 dark:group-hover:text-honey-400 transition-colors" x-text="suggestion.title"></p>
              <p class="text-xs dark:text-ink-500 text-ink-400 mt-0.5" x-text="suggestion.subtitle"></p>
            </div>
          </button>
        </template>
      </div>
    </div>

    <!-- Message list -->
    <div x-show="currentChat && currentChat.messages.length > 0" class="max-w-3xl mx-auto px-4 pt-6 pb-4">
      <template x-for="(msg, idx) in (currentChat?.messages || [])" :key="idx">
        <div class="mb-6 animate-fade-up" :style="`animation-delay:${Math.min(idx*30,200)}ms`">

          <!-- User message -->
          <template x-if="msg.role === 'user'">
            <div class="flex justify-end gap-3">
              <div class="max-w-[78%]">
                <!-- Attachments -->
                <template x-if="msg.attachments && msg.attachments.length > 0">
                  <div class="flex flex-wrap gap-2 mb-2 justify-end">
                    <template x-for="att in msg.attachments" :key="att.name">
                      <template x-if="att.type && att.type.startsWith('image/')">
                        <img :src="att.dataUrl" class="max-w-[200px] max-h-[200px] object-cover rounded-2xl border dark:border-ink-700 border-ink-200 shadow-md">
                      </template>
                      <template x-if="!att.type || !att.type.startsWith('image/')">
                        <div class="flex items-center gap-2 px-3 py-2 rounded-xl dark:bg-ink-800 bg-ink-100 text-xs dark:text-ink-300 text-ink-600 border dark:border-ink-700 border-ink-200">
                          <span>üìÑ</span><span x-text="att.name" class="font-medium truncate max-w-[120px]"></span>
                        </div>
                      </template>
                    </template>
                  </div>
                </template>
                <template x-if="msg.content">
                  <div class="px-4 py-3 rounded-3xl rounded-tr-lg text-sm leading-relaxed
                              dark:bg-honey-500/15 bg-honey-50 dark:text-ink-100 text-ink-900
                              border dark:border-honey-500/20 border-honey-200">
                    <span x-text="msg.content"></span>
                  </div>
                </template>
              </div>
            </div>
          </template>

          <!-- Assistant message -->
          <template x-if="msg.role === 'assistant'">
            <div class="flex gap-3 group">
              <div class="w-7 h-7 rounded-xl bg-honey-500 flex items-center justify-center text-sm shrink-0 mt-0.5 shadow-md shadow-honey-500/20">üêù</div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-xs font-semibold dark:text-honey-400 text-honey-600">Beesto AI</span>
                  <span x-show="msg.model" x-text="msg.model" class="text-[10px] dark:text-ink-600 text-ink-400 font-medium"></span>
                </div>
                <div class="prose-beesto text-sm dark:text-ink-200 text-ink-800 leading-relaxed" x-html="renderMarkdown(msg.content)"></div>
                <!-- Message actions -->
                <div class="flex items-center gap-1 mt-2.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                  <button @click="copyMessage(msg.content, $el)" title="Copy"
                    class="flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs dark:text-ink-500 text-ink-400
                           dark:hover:bg-ink-800 hover:bg-ink-100 dark:hover:text-ink-300 hover:text-ink-600 transition-all font-medium">
                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                    Copy
                  </button>
                  <button x-show="idx===currentChat.messages.length-1 && !isGenerating"
                    @click="regenerate()" title="Regenerate"
                    class="flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs dark:text-ink-500 text-ink-400
                           dark:hover:bg-ink-800 hover:bg-ink-100 dark:hover:text-ink-300 hover:text-ink-600 transition-all font-medium">
                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
                    Retry
                  </button>
                </div>
              </div>
            </div>
          </template>

        </div>
      </template>

      <!-- Streaming / thinking indicator -->
      <div x-show="isGenerating" class="flex gap-3 mb-6 animate-fade-up">
        <div class="w-7 h-7 rounded-xl bg-honey-500 flex items-center justify-center text-sm shrink-0 mt-0.5">üêù</div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xs font-semibold dark:text-honey-400 text-honey-600">Beesto AI</span>
          </div>
          <div x-show="streamingContent" class="prose-beesto text-sm dark:text-ink-200 text-ink-800 leading-relaxed" x-html="renderMarkdown(streamingContent)"></div>
          <div x-show="!streamingContent" class="flex items-center gap-1.5 py-1">
            <div class="w-2 h-2 rounded-full bg-honey-500 animate-pulse-dot" style="animation-delay:0ms"></div>
            <div class="w-2 h-2 rounded-full bg-honey-500 animate-pulse-dot" style="animation-delay:200ms"></div>
            <div class="w-2 h-2 rounded-full bg-honey-500 animate-pulse-dot" style="animation-delay:400ms"></div>
          </div>
        </div>
      </div>

      <div class="h-2"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Toast notification -->
  <div x-show="toast" x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-150" x-transition:leave-end="opacity-0"
    class="fixed bottom-28 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-xl text-xs font-medium
           dark:bg-ink-700 bg-ink-800 text-white shadow-xl" x-text="toast"></div>

  <!-- ‚îÄ‚îÄ Input area -->
  <div class="border-t dark:border-ink-800 border-ink-200 dark:bg-ink-950/90 bg-white/90 backdrop-blur-xl shrink-0 z-10">

    <!-- Attachment previews -->
    <div x-show="attachments.length > 0" class="px-4 pt-3 flex flex-wrap gap-2">
      <template x-for="(att, i) in attachments" :key="i">
        <div class="relative group">
          <template x-if="att.type && att.type.startsWith('image/')">
            <img :src="att.dataUrl" class="w-14 h-14 object-cover rounded-xl border dark:border-ink-700 border-ink-200 shadow-sm">
          </template>
          <template x-if="!att.type || !att.type.startsWith('image/')">
            <div class="flex items-center gap-1.5 px-2.5 py-2 rounded-xl dark:bg-ink-800 bg-ink-100 text-xs dark:text-ink-300 text-ink-600 border dark:border-ink-700 border-ink-200">
              <span>üìÑ</span><span x-text="att.name" class="max-w-[100px] truncate font-medium"></span>
            </div>
          </template>
          <button @click="attachments.splice(i,1)"
            class="absolute -top-1.5 -right-1.5 w-4.5 h-4.5 w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full
                   flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-all shadow-sm">√ó</button>
        </div>
      </template>
    </div>

    <div class="p-3 max-w-3xl mx-auto">
      <div class="flex items-end gap-2 rounded-2xl border transition-all duration-200
                  dark:bg-ink-900 bg-white dark:border-ink-700 border-ink-200
                  focus-within:dark:border-honey-500/60 focus-within:border-honey-500/50
                  focus-within:shadow-[0_0_0_3px_rgba(245,158,11,0.08)]">
        <!-- Attach -->
        <button @click="$refs.fileInput.click()"
          class="p-2.5 mb-1 ml-1 rounded-xl dark:text-ink-500 text-ink-400 dark:hover:text-ink-200 hover:text-ink-700
                 dark:hover:bg-ink-800 hover:bg-ink-100 transition-all shrink-0" title="Attach file">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/>
          </svg>
        </button>
        <input type="file" x-ref="fileInput" @change="handleFileSelect($event)" multiple
          accept="image/*,.pdf,.txt,.csv,.js,.py,.html,.css,.json,.md,.xml,.yaml,.yml,.ts,.jsx,.tsx,.java,.cpp,.c,.rb,.go,.rs,.php,.swift,.kt"
          class="hidden">

        <!-- Textarea -->
        <textarea x-ref="msgInput" x-model="userMessage"
          @keydown.enter.prevent="if(!$event.shiftKey && !isGenerating) sendMessage()"
          @input="autoResize($event.target)"
          rows="1" placeholder="Message Beesto AI‚Ä¶"
          class="flex-1 bg-transparent dark:text-white text-ink-900 placeholder-ink-400 resize-none outline-none
                 text-sm leading-relaxed py-3 px-1 max-h-[180px] font-sans"
          style="min-height:24px"></textarea>

        <!-- Stop button -->
        <button x-show="isGenerating" @click="stopGeneration()"
          class="p-2.5 mb-1 mr-1 rounded-xl bg-red-500/15 text-red-400 hover:bg-red-500/25 transition-all shrink-0" title="Stop">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="2.5"/></svg>
        </button>

        <!-- Send button -->
        <button x-show="!isGenerating" @click="sendMessage()"
          :disabled="!userMessage.trim() && attachments.length===0"
          :class="(userMessage.trim()||attachments.length>0)
            ? 'bg-honey-500 hover:bg-honey-400 text-ink-950 shadow-md shadow-honey-500/25 scale-100'
            : 'dark:bg-ink-800 bg-ink-100 dark:text-ink-600 text-ink-400 cursor-not-allowed'"
          class="p-2.5 mb-1 mr-1 rounded-xl transition-all duration-200 shrink-0" title="Send (Enter)">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path d="M22 2L11 13"/><path d="M22 2L15 22l-4-9-9-4 20-7z"/>
          </svg>
        </button>
      </div>
      <p class="text-center text-[11px] dark:text-ink-700 text-ink-400 mt-2 font-medium">
        Beesto AI may make mistakes ‚Äî always verify important information
      </p>
    </div>
  </div>

</main>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS MODAL -->
<div x-show="showSettings" class="fixed inset-0 z-50 flex items-center justify-center p-4"
  x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0"
  x-transition:leave="transition ease-in duration-150" x-transition:leave-end="opacity-0">
  <div class="absolute inset-0 bg-black/60 backdrop-blur-md" @click="showSettings=false"></div>

  <div x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 scale-95 translate-y-4"
    x-transition:enter-end="opacity-100 scale-100 translate-y-0"
    class="relative w-full max-w-[520px] max-h-[88vh] overflow-y-auto rounded-3xl
           dark:bg-ink-900 bg-white border dark:border-ink-800 border-ink-200 shadow-2xl dark:shadow-black/60 sidebar-scroll">

    <!-- Header -->
    <div class="sticky top-0 z-10 flex items-center justify-between px-6 py-5
                border-b dark:border-ink-800 border-ink-200 dark:bg-ink-900 bg-white rounded-t-3xl">
      <div>
        <h2 class="text-base font-semibold dark:text-white text-ink-900">Settings</h2>
        <p class="text-xs dark:text-ink-500 text-ink-400 mt-0.5">Manage API keys and preferences</p>
      </div>
      <button @click="showSettings=false"
        class="p-2 rounded-xl dark:hover:bg-ink-800 hover:bg-ink-100 dark:text-ink-400 text-ink-500 transition-all">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <div class="p-6 space-y-8">

      <!-- API Keys section -->
      <section>
        <div class="flex items-center gap-2 mb-4">
          <div class="w-6 h-6 rounded-lg bg-honey-500/10 flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-honey-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
          </div>
          <h3 class="text-sm font-semibold dark:text-white text-ink-900">API Keys</h3>
        </div>
        <div class="rounded-2xl dark:bg-ink-800/50 bg-ink-50 border dark:border-ink-700/50 border-ink-200 overflow-hidden">
          <template x-for="(provider, idx) in apiKeyProviders" :key="provider.id">
            <div :class="idx < apiKeyProviders.length-1 ? 'border-b dark:border-ink-700/50 border-ink-200' : ''" class="p-4">
              <div class="flex items-center justify-between mb-2">
                <label class="text-xs font-semibold dark:text-ink-300 text-ink-700" x-text="provider.name"></label>
                <a :href="provider.link" target="_blank" class="text-[10px] text-honey-500 hover:text-honey-400 font-medium transition-colors" x-text="'Get key ‚Üí'"></a>
              </div>
              <div class="flex gap-2">
                <input :type="provider.visible ? 'text' : 'password'"
                  :value="apiKeys[provider.id] || ''"
                  @input="apiKeys[provider.id]=$event.target.value; saveSettings()"
                  :placeholder="provider.placeholder"
                  class="flex-1 px-3 py-2 text-xs rounded-xl font-mono
                         dark:bg-ink-900 bg-white dark:text-ink-200 text-ink-800
                         border dark:border-ink-700 border-ink-200
                         outline-none focus:border-honey-500/60 focus:ring-1 focus:ring-honey-500/20 transition-all
                         placeholder-ink-500">
                <button @click="provider.visible=!provider.visible"
                  class="px-3 rounded-xl dark:bg-ink-900 bg-white border dark:border-ink-700 border-ink-200
                         dark:text-ink-400 text-ink-500 dark:hover:bg-ink-700 hover:bg-ink-100 transition-all text-sm">
                  <span x-text="provider.visible ? 'üôà' : 'üëÅÔ∏è'"></span>
                </button>
              </div>
              <p class="text-[10px] dark:text-ink-600 text-ink-400 mt-1.5" x-text="provider.hint"></p>
            </div>
          </template>
        </div>
      </section>

      <!-- System Prompt -->
      <section>
        <div class="flex items-center gap-2 mb-4">
          <div class="w-6 h-6 rounded-lg bg-purple-500/10 flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          </div>
          <h3 class="text-sm font-semibold dark:text-white text-ink-900">System Prompt</h3>
        </div>
        <textarea x-model="systemPrompt" @input="saveSettings()" rows="4"
          class="w-full px-4 py-3 text-xs rounded-2xl leading-relaxed
                 dark:bg-ink-800/50 bg-ink-50 dark:text-ink-200 text-ink-800
                 border dark:border-ink-700/50 border-ink-200 outline-none
                 focus:border-honey-500/60 focus:ring-1 focus:ring-honey-500/20 resize-none transition-all"
          placeholder="You are a helpful assistant..."></textarea>
      </section>

      <!-- Theme -->
      <section>
        <div class="flex items-center gap-2 mb-4">
          <div class="w-6 h-6 rounded-lg bg-blue-500/10 flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
          </div>
          <h3 class="text-sm font-semibold dark:text-white text-ink-900">Appearance</h3>
        </div>
        <div class="grid grid-cols-3 gap-2">
          <template x-for="t in [{id:'light',label:'Light',icon:'‚òÄÔ∏è'},{id:'dark',label:'Dark',icon:'üåô'},{id:'system',label:'System',icon:'üíª'}]" :key="t.id">
            <button @click="theme=t.id;applyTheme();saveSettings()"
              :class="theme===t.id ? 'dark:bg-honey-500/20 bg-honey-50 dark:border-honey-500/40 border-honey-400 dark:text-honey-400 text-honey-700' : 'dark:bg-ink-800/50 bg-ink-50 dark:border-ink-700/50 border-ink-200 dark:text-ink-400 text-ink-600 dark:hover:bg-ink-800 hover:bg-ink-100'"
              class="flex flex-col items-center gap-1.5 py-3 rounded-xl border text-xs font-medium transition-all">
              <span x-text="t.icon" class="text-base"></span>
              <span x-text="t.label"></span>
            </button>
          </template>
        </div>
      </section>

      <!-- Data -->
      <section>
        <div class="flex items-center gap-2 mb-4">
          <div class="w-6 h-6 rounded-lg bg-red-500/10 flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
          </div>
          <h3 class="text-sm font-semibold dark:text-white text-ink-900">Data</h3>
        </div>
        <div class="flex gap-2">
          <button @click="exportAllChats()"
            class="flex-1 py-2.5 rounded-xl text-xs font-medium transition-all
                   dark:bg-ink-800/50 bg-ink-50 dark:text-ink-300 text-ink-700 dark:border-ink-700/50 border-ink-200 border
                   dark:hover:bg-ink-800 hover:bg-ink-100">
            üì• Export chats
          </button>
          <button @click="clearAllChats()"
            class="flex-1 py-2.5 rounded-xl text-xs font-medium transition-all
                   bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20">
            üóëÔ∏è Clear all
          </button>
        </div>
      </section>

      <div class="pt-2 border-t dark:border-ink-800 border-ink-200">
        <p class="text-center text-[11px] dark:text-ink-700 text-ink-400">Beesto AI v2.0 ¬∑ All data stored locally in your browser</p>
      </div>
    </div>
  </div>
</div>

<script src="js/app.js"></script>
</body>
</html>
